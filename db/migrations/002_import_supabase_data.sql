-- Import data from Supabase export
-- Run this after 001_create_phev_tables.sql

-- Check if data already imported (prevent duplicates)
DO $$
BEGIN
  -- Skip if cars already exist
  IF EXISTS (SELECT 1 FROM cars LIMIT 1) THEN
    RAISE NOTICE 'Cars already exist, skipping car import...';
    RETURN;
  END IF;

  -- Also skip if PHEV entries already exist (extra safety check)
  IF EXISTS (SELECT 1 FROM phev_tracker LIMIT 1) THEN
    RAISE NOTICE 'PHEV entries already exist, skipping import...';
    RETURN;
  END IF;

  -- Disable triggers for faster import
  SET session_replication_role = 'replica';

  -- Import cars (converting UUIDs to integer IDs)
  INSERT INTO cars (name, start_date, end_date, created_at, updated_at) VALUES
  ('2024 Mitsu White PHEV', '2025-07-11', '2025-08-15', '2025-09-30T15:36:51.600707+00:00', '2025-09-30T15:36:51.600707+00:00'),
  ('2025 Mitsu Black PHEV', '2025-08-15', NULL, '2025-09-30T15:37:00.500416+00:00', '2025-09-30T15:37:00.500416+00:00');

  -- Get the IDs for mapping
  -- Car 1: d855ba4f-4e78-49b2-bf09-ab9780343d14 → Will get ID 1
  -- Car 2: 1e38daaa-b0c0-48ea-886a-6cb729df4db5 → Will get ID 2

  -- Import phev_tracker entries (mapping car_id from UUID to integer)
  -- White PHEV entries (car_id = 1)
  INSERT INTO phev_tracker (date, cost, km_driven, notes, car_id, created_at) VALUES
('2025-07-14', 0.64, 69.3, 'charge was already in the battery', 1, '2025-07-21T00:47:35.776229+00:00'),
('2025-07-15', 1.93, 43.2, '', 1, '2025-07-21T00:47:52.003814+00:00'),
('2025-07-16', 1.53, 56.8, '', 1, '2025-07-21T00:48:14.950708+00:00'),
('2025-07-17', 1.59, 60.2, '', 1, '2025-07-21T00:48:27.011902+00:00'),
('2025-07-18', 3.11, 63.6, 'higher price cause i charged at sq1 for a bit', 1, '2025-07-21T00:48:50.707422+00:00'),
('2025-07-19', 2.34, 78.5, '', 1, '2025-07-21T00:49:41.826878+00:00'),
('2025-07-20', 2.29, 73.3, '', 1, '2025-07-21T04:25:00.485808+00:00'),
('2025-07-21', 2.32, 18.4, '', 1, '2025-07-22T03:19:58.554367+00:00'),
('2025-07-22', 0.32, 63.3, '', 1, '2025-07-23T15:02:45.604357+00:00'),
('2025-07-23', 1.82, 0, 'Didn''t go anywhere today', 1, '2025-07-24T15:33:24.37042+00:00'),
('2025-07-24', 1.07, 19.1, '', 1, '2025-07-25T04:14:15.7068+00:00'),
('2025-07-25', 0.46, 5.06, '', 1, '2025-07-27T21:06:58.082817+00:00'),
('2025-07-26', 0, 0, 'Was gone to Tilsonburg', 1, '2025-07-30T15:10:58.724505+00:00'),
('2025-07-27', 0.39, 28.1, '', 1, '2025-07-28T17:01:04.850737+00:00'),
('2025-07-28', 0.99, 3.3, '', 1, '2025-07-29T13:43:01.389917+00:00'),
('2025-07-29', 0.85, 66.7, '', 1, '2025-07-30T15:10:29.651349+00:00'),
('2025-07-30', 1.85, 38, '', 1, '2025-08-01T15:23:41.575517+00:00'),
('2025-07-31', 1.17, 12.6, '', 1, '2025-08-01T15:24:11.049749+00:00'),
('2025-08-01', 0.83, 25.22, '', 1, '2025-08-02T16:10:17.477571+00:00'),
('2025-08-02', 0.72, 39.76, '', 1, '2025-08-05T16:41:48.737191+00:00'),
('2025-08-03', 0.86, 78, '', 1, '2025-08-05T16:42:16.801207+00:00'),
('2025-08-04', 1.25, 23.14, '', 1, '2025-08-05T16:42:48.832212+00:00'),
('2025-08-05', 1.32, 9.62, '', 1, '2025-08-07T15:57:32.00567+00:00'),
('2025-08-06', 1.16, 59.96, 'Lower cause I was using tarmac mode and some battery got used up there', 1, '2025-08-07T16:00:15.210869+00:00'),
('2025-08-07', 1.45, 53.1, 'same story, tarmac used', 1, '2025-08-15T14:47:43.731036+00:00'),
('2025-08-08', 0, 0, 'forgot to charge, not tracking', 1, '2025-08-15T14:48:10.285401+00:00'),
('2025-08-09', 0, 0, 'Forgot to charge, not tracking', 1, '2025-08-15T15:35:38.792092+00:00'),
('2025-08-10', 0, 0, 'Didn''t track properly', 1, '2025-08-15T15:35:58.857519+00:00'),
('2025-08-11', 0, 35.05, '', 1, '2025-08-15T15:38:42.615933+00:00'),
('2025-08-12', 1.71, 18.55, '', 1, '2025-08-15T15:39:11.708951+00:00');

-- Black PHEV entries (car_id = 2)
INSERT INTO phev_tracker (date, cost, km_driven, notes, car_id, created_at) VALUES
('2025-08-15', 0, 31.7, 'Could be a bit wrong + tarmac on highway', 2, '2025-08-27T12:54:08.325144+00:00'),
('2025-08-16', 0, 27.61, '', 2, '2025-08-27T12:59:27.291106+00:00'),
('2025-08-17', 1.68, 29.32, '', 2, '2025-08-27T12:59:52.292632+00:00'),
('2025-08-18', 1.8, 58.1, '', 2, '2025-08-27T12:49:31.798199+00:00'),
('2025-08-19', 1.69, 36.27, '', 2, '2025-08-27T13:03:29.137936+00:00'),
('2025-08-20', 0.84, 8, '', 2, '2025-08-27T13:06:51.244339+00:00'),
('2025-08-21', 0, 62.4, '', 2, '2025-08-27T13:18:29.513567+00:00'),
('2025-08-23', 2.14, 33, '', 2, '2025-08-27T13:20:50.752216+00:00'),
('2025-08-24', 1.91, 35.2, '', 2, '2025-08-27T12:45:06.487762+00:00'),
('2025-08-25', 0, 26.9, '', 2, '2025-08-27T12:44:30.541929+00:00'),
('2025-08-26', 0.93, 13.14, '', 2, '2025-08-27T13:21:53.099145+00:00'),
('2025-08-27', 0, 14.35, '', 2, '2025-09-02T14:25:59.452633+00:00'),
('2025-08-28', 0.92, 6.2, '', 2, '2025-09-02T14:29:26.34791+00:00'),
('2025-08-29', 0.31, 57, '', 2, '2025-09-02T14:29:58.739638+00:00'),
('2025-08-30', 1.79, 40, 'Lots of tarmac today, dont have an accurate reading', 2, '2025-09-02T14:33:42.327768+00:00'),
('2025-09-01', 0.2, 25.6, '', 2, '2025-09-04T04:27:20.076303+00:00'),
('2025-09-02', 0.61, 39.6, '', 2, '2025-09-04T04:28:11.397591+00:00'),
('2025-09-03', 1.31, 33.3, '', 2, '2025-09-04T04:30:03.937022+00:00'),
('2025-09-04', 0.58, 23.1, '', 2, '2025-09-09T15:47:57.512439+00:00'),
('2025-09-05', 0.57, 75, '', 2, '2025-09-09T15:52:07.785412+00:00'),
('2025-09-06', 2.24, 19.6, '', 2, '2025-09-10T21:40:06.790652+00:00'),
('2025-09-07', 0.47, 33.9, '', 2, '2025-09-10T21:41:03.93849+00:00'),
('2025-09-08', 0.92, 24.5, '', 2, '2025-09-10T21:41:27.253133+00:00'),
('2025-09-09', 0.64, 22.1, '', 2, '2025-09-10T21:42:00.187876+00:00'),
('2025-09-10', 0.53, 46.4, '', 2, '2025-09-16T05:58:32.576129+00:00'),
('2025-09-11', 0.14, 28.3, '', 2, '2025-09-16T05:59:01.297505+00:00'),
('2025-09-12', 1.2, 59.4, '', 2, '2025-09-16T05:59:44.069001+00:00'),
('2025-09-13', 1.49, 36.6, 'weekend, so price would be lower', 2, '2025-09-16T06:00:20.060451+00:00'),
('2025-09-14', 2.05, 33.4, 'weekend so lower', 2, '2025-09-16T06:00:52.703435+00:00'),
('2025-09-15', 0.95, 23.2, '', 2, '2025-09-16T06:01:25.459383+00:00'),
('2025-09-16', 0.92, 67.5, '', 2, '2025-09-23T20:11:57.731179+00:00'),
('2025-09-17', 1.31, 28, '', 2, '2025-09-23T20:12:22.793566+00:00'),
('2025-09-18', 1.25, 47.6, '', 2, '2025-09-23T20:18:44.169979+00:00'),
('2025-09-19', 1.51, 41.9, '', 2, '2025-09-23T20:28:25.861887+00:00'),
('2025-09-20', 1.85, 40.44, '', 2, '2025-09-23T20:31:34.731017+00:00'),
('2025-09-21', 2.09, 26.8, '', 2, '2025-09-26T15:59:53.625433+00:00'),
('2025-09-22', 1.27, 65.8, '', 2, '2025-09-23T20:30:34.631956+00:00'),
('2025-09-23', 2.09, 65.1, '', 2, '2025-09-25T15:12:46.869356+00:00'),
('2025-09-24', 1.59, 29.3, '', 2, '2025-09-26T15:54:25.120847+00:00'),
('2025-09-25', 1.53, 62.7, '', 2, '2025-09-26T15:52:44.529066+00:00'),
('2025-09-26', 1.47, 53.9, '', 2, '2025-09-30T11:30:28.848962+00:00'),
('2025-09-27', 1.66, 42, '', 2, '2025-09-30T18:16:19.592356+00:00'),
('2025-09-28', 2.44, 73, '', 2, '2025-09-30T11:33:28.376563+00:00'),
('2025-09-29', 1.04, 43.2, '', 2, '2025-09-30T11:31:41.246867+00:00'),
('2025-09-30', 0.92, 54.5, '', 2, '2025-10-01T13:01:19.999441+00:00'),
('2025-10-01', 1.49, 42, '', 2, '2025-10-03T10:39:48.75533+00:00'),
('2025-10-02', 0.9, 71, '', 2, '2025-10-03T10:40:10.096808+00:00');

  -- Re-enable triggers
  SET session_replication_role = 'origin';

  RAISE NOTICE 'Import completed successfully';
END $$;

-- Verify import
SELECT 'Cars imported: ' || COUNT(*) FROM cars;
SELECT 'PHEV entries imported: ' || COUNT(*) FROM phev_tracker;
SELECT 'Entries per car:' as info;
SELECT c.name, COUNT(p.id) as entry_count
FROM cars c
LEFT JOIN phev_tracker p ON c.id = p.car_id
GROUP BY c.id, c.name
ORDER BY c.id;
